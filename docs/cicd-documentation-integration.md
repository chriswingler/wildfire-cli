# CI/CD Documentation Integration Plan

This document outlines a plan to integrate automated documentation generation and deployment into the existing CI/CD pipeline (GitHub Actions).

## Goals

1.  **Automate API Documentation Generation**: Ensure that the API documentation (generated by Sphinx from Python docstrings) is always up-to-date with the codebase.
2.  **Publish Documentation**: Make the generated documentation easily accessible online, for example, via GitHub Pages.
3.  **Validate Documentation**: Check for broken links or formatting issues in the documentation as part of the CI process.

## Proposed GitHub Actions Workflow Updates

We propose adding a new job to an existing workflow (e.g., a workflow that runs on pushes to `main`) or creating a new dedicated workflow for documentation.

### Option 1: Add to Existing Workflow (e.g., `code_quality_gate.yml`)

```yaml
# .github/workflows/code_quality_gate.yml (or a relevant existing workflow)

name: Code Quality and Documentation

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  # ... existing jobs like linting, testing ...

  build_and_deploy_docs:
    needs: [ /* dependent_jobs_like_tests */ ] # Ensure docs are built after tests pass
    if: github.event_name == 'push' && github.ref == 'refs/heads/main' # Only deploy on push to main
    runs-on: ubuntu-latest
    permissions:
      contents: write # Needed to push to gh-pages branch
      pages: write    # Needed to deploy to GitHub Pages (if using GitHub Pages new system)
      id-token: write # Needed for OIDC token (if using GitHub Pages new system)


    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x' # Specify your project's Python version

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          pip install sphinx sphinx-autodoc-typehints napoleon # Add other Sphinx extensions if needed

      - name: Build Sphinx documentation
        run: |
          sphinx-build -b html docs docs/_build/html

      - name: Upload documentation artifact (optional, for PRs or other uses)
        uses: actions/upload-artifact@v4
        with:
          name: wildfire-bot-docs
          path: docs/_build/html

      - name: Deploy to GitHub Pages
        if: github.event_name == 'push' && github.ref == 'refs/heads/main'
        uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: docs/_build/html
          # Optional: specify a custom domain if you have one
          # cname: docs.yourdomain.com
```

### Option 2: Dedicated Documentation Workflow

Create a new file, e.g., `.github/workflows/documentation.yml`:

```yaml
# .github/workflows/documentation.yml

name: Documentation Publisher

on:
  push:
    branches: [ main ] # Trigger on pushes to the main branch

jobs:
  build_and_deploy_docs:
    runs-on: ubuntu-latest
    permissions:
      contents: write # Needed to push to gh-pages branch
      pages: write    # Needed to deploy to GitHub Pages
      id-token: write # Needed for OIDC with GitHub Pages

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x' # Specify your project's Python version

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          pip install sphinx sphinx-autodoc-typehints napoleon # Add other Sphinx extensions if needed

      - name: Build Sphinx documentation
        run: |
          sphinx-build -b html docs docs/_build/html
          # Add a step to check for broken links if desired:
          # sphinx-build -b linkcheck docs docs/_build/linkcheck

      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: docs/_build/html
          # user_name: 'github-actions[bot]' # Optional: customize commit user
          # user_email: 'github-actions[bot]@users.noreply.github.com' # Optional: customize commit email
          # commit_message: 'Automated documentation build for ${{ github.sha }}' # Optional
```

## Explanation of Key Steps

*   **`Checkout repository`**: Checks out the code.
*   **`Set up Python`**: Sets up the required Python version.
*   **`Install dependencies`**: Installs project dependencies (`requirements.txt`) and Sphinx-related packages.
*   **`Build Sphinx documentation`**: Runs the `sphinx-build` command to generate HTML documentation.
    *   The output directory is specified as `docs/_build/html`.
    *   A `linkcheck` builder can be added to test for broken links: `sphinx-build -b linkcheck docs docs/_build/linkcheck`. If this fails, the workflow step should fail.
*   **`Upload documentation artifact` (Optional)**: This step can be useful for pull requests to allow reviewers to download and check the generated documentation before merging.
*   **`Deploy to GitHub Pages`**:
    *   Uses the popular `peaceiris/actions-gh-pages` action to deploy the contents of `docs/_build/html` to the `gh-pages` branch.
    *   GitHub Pages can then be configured to serve documentation from this branch.
    *   Requires `permissions` to be set correctly for the job.

## Configuration for GitHub Pages

1.  After the workflow runs successfully for the first time on the `main` branch, a `gh-pages` branch will be created with the documentation content.
2.  In the GitHub repository settings, navigate to "Pages".
3.  Under "Build and deployment", select "Deploy from a branch" as the source.
4.  Choose the `gh-pages` branch and the `/ (root)` directory, then save.
5.  The documentation site will become available at `https://<username>.github.io/<repository-name>/`.

## Further Considerations

*   **Documentation Versioning**: For more complex projects, consider integrating tools like `sphinx-multiversion` if different versions of documentation need to be maintained.
*   **Markdown Linting**: Add a step to lint Markdown files in the `docs/` directory using tools like `markdownlint-cli`.
*   **Sphinx Warnings as Errors**: Configure Sphinx to treat warnings as errors in the CI environment to catch issues early (`sphinx-build -W ...`).

This plan provides a solid foundation for automating documentation within the CI/CD pipeline, improving documentation quality and accessibility.
